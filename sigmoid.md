#【Reinvent】如何发明Sigmoid函数？

日常生活中，我们经常会听到一类说法：
> * 年龄每增加10岁，心脑血管的发病几率就翻倍
> * 气温每上升1度，非洲内战几率增加50%
> * 男人的智商每增加16分，结婚的几率便升高35%

对于这类说法，我们大部分人可能认为句中的几率就是事件发生的概率。
而且同时必然会察觉到这种说法不严谨：如果概率不断翻倍，岂不是可能超100%？

本文将解释这类说法中的_几率_可以如何理解，并由此重新发明softmax函数。

## 买冰淇淋的几率

假设小G走在一片沙滩上，看到路边有一个冰淇淋摊，这时候他会不会买个冰淇淋吃呢？
我们可以认为小G买冰淇淋这个事件具有随机性，按一定的概率发生。
而且在不同的条件下，这个事件发生概率大不相同。
气温、冰淇淋价格、排队人数、小G自身的状态等，都会影响他买冰淇淋的概率$p$。

现在我们只考虑一个变量，就是当时的气温$T$（C°）。
假设小G对气温特别敏感：

* 当$T=30$时，小G买冰淇淋的概率$p=0.5$
* 气温每增加1度，小G买冰淇淋的几率翻倍

这里，第二条假设中没有用_概率翻倍_这个表述，而用的是_几率翻倍_这个表述。
因为如果是概率的话，$T=31$时$p=1.0$；$T=32$时$p=2.0$，显然是有问题的。
那么这里的几率到底是什么呢？
其实这里的几率，可以理解为_发生比（odds）_。
## 发生比（Odds）
中文里的_几率_和_概率_在很多场合是可以互换的。
这就导致了母语为汉语的我们往往会忽略几率的另一种解释。
然而几率经常会被翻译成odds或probability，概率总是被翻译成probability。
反过来，英文单词odds会被译为几率，probability则会被译为概率，几乎不会互换。

为了更有区分度，学者们引入了一个新名词来专指odds，即_发生比_。
一个事件的发生比（odds）是该事件发生和不发生的比率，即$o=p/(1-p)$。此时容易得到$p=o/(1+o)$。

上面的例子中，当$T=30$时，小G买冰淇淋和不买冰淇淋两者概率是一样的，所以$o=1:1$。
如果把几率理解为发生比，例子中的第二条假设就完全讲得通了：
当$T=31$时，小G买冰淇淋的发生比翻倍，即$o=2:1$，此时$p=2/3$；当$T=32$时，$o$再翻倍，即$o=4:1$，此时$p=0.8$。

## Sigmoid函数[^1]
接下来很自然的，我们考虑例子中概率$p$和温度$T$之间的关系。
可以注意到当$T=30$时$p=0.5$是一个很特殊的数据点。
为了利用对称性，我们用$x$来表示$\Delta T$，即$x=T-30$。
此时当$x=0$时$p=0.5$。

在这种设定下，很容易得到发生比$o=2^x$，而概率可以写成：
$$p=\frac{o}{1+o}=\frac{2^x}{1+2^x}=\frac{1}{1+2^{-x}}$$

聪明的你可能已经看出来了，如果把公式中的$2$换成$e$，我们就得到了sigmoid函数：
$$\sigma(x) =\frac{1}{1+e^{-x}}$$

## 合理性
顺着上面的思路走下来，我们确实得到了sigmoid函数。
但读者可能会对其中一些步骤的合理性感到困扰。下面我们再来琢磨几个重要步骤：

* **为什么引入中间变量，即发生比$o$？**<br/>-概率$p$的取值范围是$[0,1]$，这个限制对于加减乘除乘方等基础变换来说都不太友好。而发生比$o$其取值范围是$[0,+\infty]$，对于基础变换来说就方便且自然多了。另外，发生比$o$本来就是一个很自然的概念，历史上甚至比概率$p$的概念出现还要早一些。
* **$T$每增加1，$o$就翻倍合理吗？**<br/>-翻倍就是乘以$2$，乘以别的正实数也一样，比如$1.5$，比如$e$。考虑到最基础的运算就是乘法或者加法，我们需要讨论的是这里乘法比加法更合理吗？考虑两种情况：$p=0.01$时$T$增加1，和$p=0.5$时$T$增加1。虽然$T$都增加了1，但显然让$o$增加同样的数字是不合理的，而$o$乘以同样的数字则合理得多。
* **为什么用$\Delta T$而不是$T$？**<br/>-其实用$T$来表示$p$的话，只是把sigmoid函数图像做了一个横向的平移，有兴趣的同学可以试试看。
* **为什么把$2^x$换成$e^x$？**<br/>-假设中，$T$每增加1，$o$就乘以$2$。这里的$2$可以换成任何正实数，换成$e$的话公式最优美不是吗？注意到$a^x=e^{x \cdot ln\ a}$，令$x^\prime=x\cdot ln\ 2$，以$2$为底和以$e$为底就可以互相变换了。

## 小结
本文通过探究类似“$x$每增加$\Delta$，发生比$o$就要乘以$a$”的表述，以及引入发生比（odds）这个概念，经过一系列数学推导得到了sigmoid函数。
然后我们还讨论了推导步骤中部分假设的合理性。
当然，这仅是一种从机器学习的角度（即通过变量来预测概率）来考虑的推导方式，不是唯一的推导，也不是最初的推导。
希望能给读者带来一定的启发。

## 参考资料

* enwiki:Odds ([https://en.wikipedia.org/wiki/Odds](https://en.wikipedia.org/wiki/Odds))
* enwiki:Sigmoid function ([https://en.wikipedia.org/wiki/Sigmoid_function](https://en.wikipedia.org/wiki/Sigmoid_function))

[^1]: 狭义上的sigmoid函数指的是logistic函数，即$\sigma(x)=1/(1+e^{-x})$。广义上的sigmoid函数指的是形状像S曲线的函数，包括$tanh$,$arctan$等。本文中取狭义sigmoid函数的概念。